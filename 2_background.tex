\chapter{Background}

%\hl{rework this}\\
%The popularity of batteryless designs in the research community has increased over the past decade. This popularity has resulted in a focus on improving the design of these systems to mitigate their drawbacks.
%The end goal of batteryless researchers is to create a design pattern that can be reused for general-purpose applications, resulting in a fixation on design, without sufficient grounding in real applications~\cite{hester2017future}. The reality is that the batteryless archetype will never be able to provide a general purpose solution for reliable and consistent sensing, and is only appropriate for niche applications.
%This chapter explores the landscape of wireless sensor power supply design and applications,
%identifying several overarching design archetypes and
%grounding the design process through an application-focused lens.
%By abandoning previous assumptions
%%about the necessity of the batteryless archetype,
%and starting with a blank slate and a holistic view of available technology and application requirements, we can return to application-focused power supply design to create simpler, long-lived, and reliable solutions.
%%This chapter defines common wireless sensor power supply design archetypes, and situates these archetypes within a deconstructed view of the application landscape.

\section{Batteryless Sensing}
\label{sec:background:batteryless}
The batteryless, or intermittent, wireless sensor movement has abandoned batteries (both rechargeable and non-rechargeable) under the assumption that current battery technology has too many detracting qualities to be suitable for energy-harvesting wireless sensor storage.
Most notably, they argue that batteries provide insufficient lifetimes to build long-lasting deployments~\cite{hesterTragedy15, hesterFlicker17, hesterTimely17, hester2017future, colinReconfigurable18, luciaIntermittent17, yervaGrafting12, majid2020continuous}.
Batteryless systems instead utilize capacitors, some types of which offer functionally infinite lifetimes~\cite{kemetLife}.
However, capacitors and supercapacitors provide very little energy storage when compared to batteries.
%. Ceramic and tantalum capacitors possess functionally infinite lifetimes, while supercapacitors offer lifetimes on the order of decades to a century~\cite{kemetLife}.
%The relatively small energy storage afforded by capacitors and supercapacitors is a fundamental limitation and is the trade off when prioritizing power supply lifetime over any other performance metric.
Due to this, the batteryless design decision results in two major drawbacks:
at any given time, a batteryless system is limited to the energy provided by the short discharge cycle of its capacitor bank,
and the availability of the system is determined by the consistency and intensity of energy income.

A batteryless system can technically perform the operations of a wireless sensor.
However, it does not mean it does them well.
When these systems are harvesting enough power to turn on and operate, they can only perform operations that require less energy than their capacitor storage can hold.
Often a batteryless system's source of energy is intermittent, resulting in a system that operates intermittently.
When harvestable energy is unavailable, batteryless systems quickly deplete their
small energy stores, and lacking any future energy,
they power off and lose
volatile state, potentially in the middle of an important operation and for an extended and unknown period of time.
The intermittent reality of many harvesting sources necessitates extremely careful management of energy
%and complex software control of volatile state
and detailed and thorough software optimization
to ensure that \textit{any} operations can be completed.

Despite these complications, the concept of an immortal wireless sensor is extremely tantalizing, and is the driving motivation behind batteryless systems research.
%This potential for extremely long-lived sensors has led to significant work to enable and improve batteryless systems.
This has resulted in a wealth of batteryless systems work, the majority of which is focused on developing software solutions that manage and preserve volatile state to enable forward progress between reboots.
This extends the capability of applications beyond that of a single capacitor buffer discharge cycle, and is useful for building more general and capable systems.
Batteryless devices are also extremely difficult to debug and develop software for, as in addition to software bugs, energy is no longer guaranteed at any point during execution.
To this end, researchers have also built tools to recreate energy conditions to help diagnose and fix intermittent energy bugs.
%Platform builders have also experimented with novel hardware techniques to increase responsiveness by reducing charging hysteresis.
In addition to sofware solutions, researchers have designed hardware platforms that maximize individual component availability, as well as platforms that dynamically tune capacitance to meet individual operation energy requirements.
%The software solutions presented by batteryless researchers are solutions developed for self-imposed problems stemming from limited energy storage, and hardware solutions offer marginal improvements to system responsiveness at a prohibitive cost.
The next sections discuss various system designs, tools, and software and hardware techniques meant to alleviate the two fundamental drawbacks to batteryless systems.
%Energy-harvesting systems that rely
%on small (super)capacitor energy buffers are commonly referred to as intermittent systems, as they only store enough energy to perform single atomic tasks, and are unable to operate when external energy is not present.
%Many choose to employ
%capacitors as an energy buffer due to their theoretically infinite lifetime,
%but are limited to small energy capacities, and are only as reliable and
%lively as their source of harvested energy.
%In situations of energy drought,
%these platforms quickly deplete their
%small energy stores, and lacking energy,
%they power off and lose
%state, potentially in the middle of an important operation or for an extended period of time.
%Due to this reality, researchers have spent the past decade
%designing more predictable and usable batteryless systems. This has resulted in several different hardware and software design methods and techniques for intermittent systems.

\subsection{Forward Progress and State Retention}
The type and amount of work that is possible within the energy envelope of a single discharge cycle of capacitor or supercapacitor buffer is extremely limited.
%Applications and devices that employ a one-shot technique are
Batteryless systems are generally only able to perform a few seconds or less of computation, or send a single packet before depleting their capacitor storage and powering off, even with modestly sized supercapacitors.

\subsubsection{One-shot Intermittency}
\label{cha:background:one-shot}
One of the simplest methods employed by batteryless systems does not bother to attempt to retain state across power loss and reboots.
One-shot intermittent designs instead just allocate enough capacitance to turn on and perform a predefined task, like sending a packet.
This method is reminiscent of the simple reply behavior of RFID tags, upon which the design of early intermittent systems is based on~\cite{sample2008design}.
These systems may act as a simple beacon~\cite{campbell2016cinamin,saoda2019no}, or a sensor~\cite{yervaGrafting12, debruin2013monjolo, campbellEnergy14, campbellThermes14}.
For some platforms, most notably the Monjolo family of devices, the rate of harvesting is used as the sensor itself. Every wake-up and transmit event corresponds to an amount of energy harvested, and can be used to quantify the harvested phenomenon~\cite{campbellThermes14, campbellEnergy14, debruin2013monjolo}.
This method of coupling harvesting and sensing is the only way to ensure that interesting sensor data is observed by a batteryless sensor.
Otherwise, when a batteryless sensor is built to sense a phenomena other than what it is harvesting, it is inevitable that the majority of instances, changes in the sensed phenomena will be missed because the sensor is offline.
However, even when sensing and harvesting is coupled, a one-shot batteryless design often does not have the energy required to support message retransmission in the case of packet loss, or generally support any network reliability mechanisms.
Any observation may be lost upon packet failure, and the next time the sensor wakes up it only has enough energy to be concerned with transmitting its current, more recent observation.
This one-shot method is relatively simple compared to other approaches to batteryless software, but it still requires tedious cold-start software optimization and capacitance tuning to allow the device to power on and complete its workload within the constraints of its tiny energy storage.
This severely limits the generality of systems developed with this approach.
Performing any sensing or computing outside of the hardware's intended use case is often not possible.
Like all batteryless sensors, it is also impossible to distinguish between sensor failure and a lack of energy.

\subsubsection{Checkpointing}
Given the limitations of the one-shot technique, researchers have developed tools and techniques for
ensuring forward progress across system reboots to enable longer and more complex workloads than a single capacitor bank can support.
%Since the development of the WISP platform~\cite{sample2008design}, researchers have continuously developed software tools, methods, and techniques to save state and resume operation across power outages, allowing for longer running computation or transmitting more data than a single capacitor bank would support.
One method of enabling forward progress is checkpointing,
where important volatile state is saved at predetermined and run time locations in code before a power outage, and restored upon rebooting. Many methods have been proposed, using both static and dynamic methods.
Mementos~\cite{ransford2012mementos} utilizes a modified LLVM compiler, as well as a run-time library, to automatically place checkpointing triggers within a program. During run-time, at these trigger points, Mementos measures the system voltage, and if low enough, portions of volatile RAM state are written into non-volatile flash before turning off.
The introduction of new non-volatile technologies like Ferroelectric RAM (FRAM) allows more energy and time efficient checkpointing, while simultaneously simplifying the state retention logic.
Hibernus~\cite{balsamo2014hibernus} does not use predefined trigger points, and instead utilizes a hardware interrupt to detect a low system voltage threshold, and immediately copies volatile state to FRAM. This state is subsequently restored on a rising voltage interrupt.
Checkpointing is an effective method for enabling forward progress, however software development with checkpointing can be very difficult to develop and debug, and can become prohibitively expensive in non-volatile state, time, and energy as volatile state increases.
%improving the programmming and debugging experience for batteryless programmers.
%Writing programs for intermittent operation introduces bugs that do not exist with continuous operation, and requires more advanced debugging techniques to address them.

\subsubsection{Batteryless Debugging}
For batteryless systems, it
is very difficult to properly and correctly develop software, especially when non-volatile memory like FRAM is involved.
One-shot system software is difficult to tune and optimize to complete all within the energy provided by capacitor storage.
For checkpointing systems, if checkpoints are improperly placed such that atomic blocks are not completed entirely before power loss, and yet their partial state is recorded in non-volatile memory,
it can result in inconsistencies between volatile and non-volatile state.
Software development and debugging for batteryless systems must also consider energy state in addition to normal embedded software bugs.
To this end, researchers have developed hardware-software debugging tools that emulate and replay energy state based on energy trace captures.
Ekho is an energy emulator that recreates and repeats energy harvesting conditions for low power energy harvesting devices~\cite{hester2014ekho}.
Another tool, the energy-interference-free debugger (EDB), also replays energy state, specifically for intermittent systems~\cite{colin2016energy}.
EDB augments normal interactive debugging tools like GDB to allow real time playback of energy state, in addition to interactive program debugging.
While these tools are useful and necessary for ensuring correctness in batteryless development, they do introduce substantial complexity on top of the already complex embedded software development toolchain.

\subsubsection{Safe Forward Progress}
While conceptually simple, checkpointing is not a perfect solution to saving state, especially as that state begins to increase in footprint as applications increase in capability and complexity. There is an upper bound to the size of checkpoints, where the energy required to save and read state to and from non-volatile memory exceeds that of various capacitor storage sizes.
The advent of FRAM (as well as other non-volatile RAM technologies) results in methods that can avoid explicitly saving and reading back the majority of application state. State that would normally reside in volatile RAM can now be placed within non-volatile memory, allowing this state to persist across power outages.
While this seems like a straightforward solution to preserving state, it is complicated by the shrinking
boundary between volatile and non-volatile state. Often both SRAM and FRAM are memory mapped and accessed the same way. Writes and reads to either are indistinguishable to the programmer and compiler.
Code is often executed multiple times through the course of intermittent execution, and if volatile and non-volatile state are not carefully managed and accessed by the programmer, re-execution of various code sections can result in consistency violations~\cite{maeng2017alpaca}.
The aftermentioned debugging tools can help to detect and fix intermittency bugs during runtime testing. However, many researchers have developed solutions to avoid these bugs by design.
Task-based programming frameworks and models like
Chain~\cite{colin2016chain} and Alpaca~\cite{maeng2017alpaca}
ensure forward progress and prevent intermittent consistency bugs.
The task model of execution splits a software application into idempotent code blocks that read inputs from other tasks, and upon completion write their own results to channels of non-volatile memory. This has the effect of increasing task throughput in addition to ensuring safe forward progress.

\subsubsection{The Wrong Abstraction}
While effective in ensuring safe forward progress, all of these techniques introduce
significant software and compiler complexity.
%on top of an already complex embedded software development toolchain.
They also necessarily limit programming scope to defined frameworks and concepts to ensure various constraints and guarantees of safety.
Batteryless programmers must learn and adopt new programming models that incorporate potentially unfamiliar concepts like tasks, channels, and flows~\cite{colin2016chain,maeng2017alpaca,hesterTimely17}.
Once programmers have mastered the new patterns and methods of batteryless programming, intermittency is largely hidden from them.
This is by design and one of the main goals of these programming models and frameworks.
However, the abstraction of continuous progress is more harmful for application developers than helpful.
%To a programmer, the abstraction of continuous progress is easily conflated with continuous operation.
This abstraction provides the illusion of continuous computing progress in processor time, while robbing programmers and users of any meaningful notion of progress in wall clock time.
Continuous operation of a batteryless systems is often impossible, and software methods for forward progress only guarantee \textit{eventual} task completion.
While these techniques may make it easier to program batteryless systems,
the abstraction of continuous forward progress is misleading regarding the timeliness and availability of batteryless systems for many applications.
System designers and programmers are left without a way to reason about the actual performance of applications built on top of fundamentally unreliable systems.
%An abstraction that guarantees forward progress without feedback or some metric of \textit{what} that forward progress consists of or how long it takes removes agency from the programmer.
%This abstraction makes it extremely difficult to reason about the actual reliability and availability of applications built on top of fundamentally unreliable systems.
%The eventual forward progress allowed by these techniques inflates the perceived utility of these systems,
%as they suggest continuous and eventual operation and progress. In reality, they operate with no guarantee of reliability or even eventual task completion.
%This results in systems that technically function in the sense that they occasionally perform a task when energy is available, but there is no guarantee as to how long a task will take to complete, nor that they are capturing an accurate representation of a sensed phenomenon.
%their overall performance and reliability is unpredictable and varies widely depending on their environment and deployment location.
%No amount of software techniques and improvements will address the unreliability of batteryless systems, as it is a fundamental result of a design with insufficient energy storage to support continuous and reliable operation.

\subsection{Timeliness and Availability}
While convenient during programming, the abstraction of continuous operation without a notion of real performance does not result in responsive and available batteryless systems.
While they ensure safety and improve performance over checkpointing-based approaches, the aftermentioned task-based programming models
do not consider or provide solutions for increasing batteryless system responsiveness and availability,
two qualities that are especially important for wireless sensing.
Timeliness and availability are goals that are generally at odds with the reality of batteryless sensing, as no guarantees can be made about energy income and thus the timeliness of event completion or system availability.
A batteryless system's intermittent execution can span unknown periods of time, where it iteratively works on a task whose results may be stale and no longer useful by the time it finishes. There is also no way to ensure that a batteryless system is awake to witness a given event.
Despite this, researchers have developed both software and hardware solutions in attempts to improve batteryless responsiveness and availability.

\subsubsection{Software Timeliness and Availability}
Mayfly~\cite{hesterTimely17} and InK~\cite{yildirim2018ink} are task-based software frameworks like Chain and Alpaca. In addition to ensuring safe forward progress, they also attempt to maximize system timeliness and availability respectively. Mayfly associates tasks and the data they produce with deadlines, and maintains time through power failures.
After a datum's deadline passes, it is discarded and energy is not used to further process or transmit it.
This approach prioritizes fresh data, and allocates more energy towards completing tasks that can be completed within their deadline.
This enables applications that depend on timely data, such as activity recognition. Alpaca and Chain are unsuitable for such applications, as they are unable to distinguish between expired irrelevant data and new fresh data.
While it increases the timeliness of a system, Mayfly does not increase the amount of reported data by a system or its availability. By design, it must sacrifice stale, potentially important data in order to report fresh data.
It is uniquely suited for applications that are only concerned with close to real time data.

InK prioritizes availability by incorporating timers, interrupts, and event handling into a batteryless context.
The runtime utilizes sleep states and low power interrupts to persist for longer periods and increase the likelihood of detecting and capturing events. It also utilizes an ultra-low power timer subsystem to ensure timekeeping across power failures.
With these improvements, a system using Ink is able to capture 14x the number of events over the same system using Alpaca.
While this seems like a dramatic increase, Alpaca was simply not designed for event detection, and performs abysmally when applied to such a task. Additionally, the system with Ink was only able to capture slightly over half of the events even when in controlled solar harvesting conditions~\cite{yildirim2018ink}. The authors sadly did not compare the performance of these runtimes with that of a traditionally programmed and continuously powered embedded system, so there is no baseline comparison.

While these approaches increase the timeliness and availability of a system,
it is \textit{impossible} for a batteryless system without continuous energy income to ever approach 100\% event detection or data capture and transmission reliability.
Fundamentally, there will be periods of time where there is no available energy, a batteryless system will remain off, and important events will remain undetected and important data will be discarded as it grows stale.

%Beyond software techniques to improve the intermittent programming experience, ensure forward progress, and increase reactivity,
%researchers have also developed novel hardware and system designs to
%increase the responsiveness and availability of batteryless systems.
%Many hardware techniques focus on the fine-grained management
%of capacitor charging hysteresis.
%Unlike the relatively stable voltage provided by a battery, a capacitor's voltage is related to the square root of stored energy. This means that during a discharge cycle, an intermittent system will experience a pronounced voltage drop from a maximum $V_{max}$ to a minimum $V_{min}$.

\subsubsection{Hardware Hysteresis Management}
\label{sec:background:hhm}
Beyond software techniques, researchers have also explored building specialized hardware solutions to increase system availability.
Batteryless system operation is generally tied to a full swing capacitor charge/discharge hysteresis. Once enough energy is captured, a batteryless system will begin executing its workload until it has exhausted its stored energy.
The general rule of thumb for batteryless system capacitor sizing is that it must hold enough energy to support the most energy intensive atomic task of the system, such as operating a sensor, performing some quanta of computation, or transmitting a single radio packet~\cite{nardello2019camaroptera,colinReconfigurable18, shukla2019skinnypower, hesterFlicker17}.
This represents the smallest amount of energy storage that results in a feasible system with checkpointing or other forward progress mechanism.
All batteryless systems operate within the bounds of capacitor storage voltage thresholds.
The energy stored within a capacitor is directly related to the voltage across its electrodes.
\begin{equation}
\label{eq:cap_energy}
    E = \frac{1}{2}C(V_{max}^2 - V_{min}^2)
\end{equation}
The upper hysteresis threshold $V_{max}$, the point at which the device turns on during charging, is the voltage at which a capacitor is full, and the lower threshold $V_{min}$, the point at which the system turns off, is the minimum
operating voltage of the components in the system.
Smaller capacitors can charge to an upper
threshold and turn on faster, but store less energy.  Larger capacitors store more energy, but charge slower.
Hysteresis management
techniques attempt to combine different sized capacitors to
optimize the charging time and available energy for specific tasks.
Managing hysteresis also allows for more platform generality, as the capacitor storage can be optimized for various operations and workloads.
Notable examples of platforms that utilize this technique are the Flicker and Capybara platforms~\cite{hesterFlicker17, colinReconfigurable18}.

The Flicker
platform practices federated energy storage, where each module (sensor, radio, microcontroller) has its own built in capacitor that is tuned to the task it is expected to perform~\cite{hesterFlicker17, hesterTragedy15}.
This has the
effect of allowing various components to charge their storage quickly and begin operating before other parts of the system turn on or are needed. This also
isolates power failure to independent components.
Federated storage provides only marginal improvements with regard to component availability and energy harvesting efficiency. A federated approach only provides an average increase of 6.7\% for microcontroller uptime (from 64.2\% to 70.9\%) and a 1.5\% increase for radio uptime (from 3.8\% to 5.24\%) over a single duty cycle. Likewise, a federated approach provides at most a 10\% improvement in energy harvested over a duty cycle~\cite{hesterTragedy15}.
A federated approach incurs overhead involving additional hardware complexity in the form of voltage monitoring circuitry as well as more complex software to manage and make use of the additional voltage information. The additional hardware increases the size, cost, and energy overhead of the system.

The Capybara platform also manages capacitor hysteresis to increase system responsiveness and reactivity. However instead of using federated capacitor storage, it utilizes a central capacitor bank that can be dynamically resized~\cite{colinReconfigurable18}.
This is a more flexible approach than federated energy, where each hardware peripheral is designed with a specific amount of capacitance to support a predetermined task.
Capybara can resize its capacitor bank on the fly to match the energy required by an arbitrary task. This results in the lowest possible cold start and capacitor recharge times to support a given operation.
Under controlled conditions with consistent harvestable power, Capybara's dynamic reconfiguration is able to detect 2-4x of events over a system with statically allocated capacitance. However, this improvement only detects 40-70\% of possible events, even under optimistic harvesting conditions.
To support this dynamic resizing, Capybara introduces an extremely complex power system design that occupies significant board area. The design includes five mixed capacitor and supercapacitor banks, four state-retaining switches for connecting the capacitor banks to the load and harvester, and a custom power distribution circuit to charge the configuration of connected capacitors.

These techniques are based on the assumption that a full swing capacitor hysteresis with full power downs are necessary and unavoidable. Batteryless systems are often not designed to support a low power sleep state with volatile state retention.
%This assumption is unique and common with batteryless systems, where uptime is severely limited by the system's active power and available energy storage.
%Energy must be micromanaged on the scale of milliseconds to seconds, which leaves very little slack to preallocate enough energy to enter and persist within a sleep state. Often, batteryless designs do not bother to optimize for a sleep state.
Sleeping is a difficult operation, as it is difficult to proactively retain enough energy to enter and sustain a sleeping state when future availability of energy is uncertain.
Additionally, with such small capacitor storage, energy must be micromanaged on a time scale of milliseconds to seconds.
The precision timing of entering sleep state at the correct capacitor voltage level is often not worth the engineering effort to implement when compared to allowing the system power off naturally. Thus, batteryless systems are not often optimized for sleeping.
For example, Capybara is by design an inefficient sleeper. Its power supply has a significant
"power overhead of the power system" that limits the effectiveness of
any low power state besides being completely off~\cite{colinReconfigurable18}.
The decision to design around constant reboots incurs significant cost in energy and time. Without significant software optimization, the initialization of a processor, radio, and other peripherals is an expensive operation. If capacitor storage is allowed to leak (over the course of hours without any harvestable energy) the voltage may drop to a point that a boost converter must cold start.
Cold start is also very expensive, as harvesting ICs and boost converters are optimized for steady state operation and not cold start efficiency.
For example, the TI BQ25505 boost charger~\cite{bq25505} is capable of operating at \textgreater90\% efficiency at voltages higher than 1.5\si{\volt}.
However, its worst case cold start efficiency is 5\%, and requires at least 600\si{\milli\volt} input and 400\si{\milli\watt} instantaneous power to exit cold start.
Over the course of operation, a batteryless system will experience many repeated cold starts, resulting in wasted energy and time on charging a capacitor to a working, steady state voltage.

%While the design decisions to manage and fine-tune hysteresis make sense in the intermittent context, the importance placed on cold start optimization is specific to the power efficiency and limited energy capacity of a batteryless design.

%However, in times of gratuitous harvestable energy, a batteryless system should be able to maintain a low power sleep state for a long time, and avoid incurring the cost of repeated cold-start.
%Despite this, most batteryless systems assume the necessity of a full-swing operation, and their design abolishes the possibility of sleeping.

%Due to this, most intermittent system designs opt to fully discharge energy storage on every operation instead of sleeping. Because of this, batteryless system designers must often focus on optimizing the cold start of their system.
%In practice, if a system has the ability to enter a low power sleep mode with state retention, it can avoid frequent cold start and control its energy usage by willfully entering these
%states.
%With this operating principle, the benefits of hardware hysteresis management are limited to reducing cold start time and are workload independent.
%We show that the energy captured
%by these systems and their subsequent availability
%could be substantially improved by using larger energy buffers.

%Simultaneously sensing and harvesting the same phenomenon is one of the most effective use cases of batteryless sensors, however being able to simultaneously sense and harvest is not always possible, and is generally limited to light, temperature differentials, vibration, and RF sources.

\subsubsection{Redundancy for Statistical Availability}
Beyond software and hardware techniques for forward progress, timeliness, availability, and reactivity, researchers have also explored approaches that utilize cooperation within a network of batteryless devices.
Most notably, the Coalesced Intermittent Sensor (CIS) is an abstraction of a group of intermittent sensors that combines the availability of each sensor to increase the availability of the group as a whole~\cite{majid2020continuous}.
The approach leverages the theoretical uniform distribution of on-times of an ensemble of sensors, each of which is intermittently operating, to maximize the probability that at least one sensor is on to detect a phenomena at any given time.
While this approach may work in carefully controlled environments with specific applications, it is dependent on several assumptions that are difficult to justify when considering real world conditions.

It is assumed that all nodes within a CIS ensemble have a priori knowledge about the size of the deployment and all nodes are sufficiently co-located to experience the same harvesting conditions and sense the same phenomena.
These assumptions are unrealistic when considering real-world deployment scenarios.
Without a mechanism to autonomously and dynamically update network node count, it is onerous for system maintainers to physically reprogram and update each node when a new member is added to the CIS.
If all nodes need to be co-located for the CIS algorithm to function, it raises the question as to why this problem could not be solved with a single node with a proportionally larger solar panel and energy storage, instead of the 20-50 nodes it would require to achieve high availability in low light levels.
The evaluation of the CIS greatly overestimates the light levels available to an indoor sensor,
and assumes that node on-times are uniformly distributed.
In a real deployment, with sensors that are not co-located, light levels can differ by at least 10x,
and indoors levels are usually much lower than 300 lux~\cite{yervaGrafting12}.
The evaluation of the CIS sensor shows less than 50\% availability when exposed to 300 lux. The only scenario in which the CIS approaches 100\% availability is when it is exposed to an LED array providing a constant 1000 lux, an unrealistic environment for many indoor sensors.
The CIS approach, like all batteryless approaches, is dependent the existence of any harvestable energy.
In most real-world situations, periods of no energy are common, such as nighttime. These periods result in 0\% availability, regardless of the amount of node redundancy.
For infrequent events with high light levels, the on-times for nodes within the CIS are extended as they are exposed to more energy allowing longer sleep. Nodes that are simultaneously sleeping may then trigger on the same event, essentially synchronizing their on and off times. This results in duplicate event detection and missed subsequent unique events, and temporarily breaks the assumption of uniformly distributed on-times.
Beyond the questionable assumptions made by the CIS approach, the event-detection applications that are appropriate for a CIS are limited to short and burst events that can be captured in one intermittent duty cycle.

\subsection{The Batteryless Fallacy}
The aforementioned programming models, runtime systems, debugging tools, hardware platforms, and device redundancy schemes represent over a decade of successive and increasing complexity and sunk cost in batteryless design.
%As an almost perfect example of the sunk cost fallacy, the researchers that have designed these solutions argue that all these complex techniques are justified and necessary for the usability and functionality of batteryless systems, despite their marginal gains in performance.
The researchers who have developed these solutions would almost definitely argue that this body of work is justified and necessary for the usability and functionality of batteryless systems, and wireless system design in general.
Beyond the ability for a system to safely progress across reboots, the gains in performance provided by various software and hardware techniques are marginal.
The value of these improvements is reduced when considering the abysmal baseline and maximum theoretical performance of a batteryless system.
Due to the nature of batteryless systems, the maximum achievable performance is entirely limited by the availability of energy, which is often low and unpredictable in real world applications.
Despite the simultaneous high complexity and poor performance of batteryless systems, proponents of the design believe that they are the future of wireless sensor design~\cite{hester2017future}.
%The complexity and unreliability of batteryless designs make them unattractive for industry solutions, especially when battery-based systems are able to achieve high reliability with decade-plus lifetimes with modern microcontroller and radio technology.

Batteryless proponents believe that batteries are the single greatest threat~\cite{hester2017future} or the main obstacle or barrier for truly ubiquitous sensing~\cite{majid2020continuous, shukla2019skinnypower}.
The general batteryless position is that the only \textit{reasonable} option for the future of wireless sensors is to abandon batteries.
Many of the arguments vilifying batteries lack citations or quantitative evidence~\cite{hester2017future, hesterTragedy15, hesterFlicker17, hesterTimely17, hester2017future, colinReconfigurable18, luciaIntermittent17, yervaGrafting12, majid2020continuous}. When citations are provided, they are often outdated and are misrepresentative or ignorant of current battery technology~\cite{majid2020continuous}.
This has resulted in a community that continuously republishes the same dishonest and incorrect arguments,
woefully ignorant of or unwilling to embrace the technology improvements (including batteries) that would render many of their batteryless solutions irrelevant and extraneous.

There is a valid argument that the batteryless design archetype is suitable for various niche applications, which is further explored in \cref{sec:background:app}, however it is incorrect to argue that \textit{all} applications can be supported by batteryless sensors.
Despite this, many proponents of the batteryless design point do argue that the approach is general purpose. They argue that with sufficient technology improvements, batteryless sensors will eventually be able to support a majority of wireless sensor network applications~\cite{hester2017future}.
This claim ignores the significant downsides to batteryless design, all stemming from an insufficient energy capacity that is unable to support sensor operation beyond a single duty cycle, and only when external energy is available.
This limitation is \textit{fundamental and inescapable}, regardless of the myriad of software or hardware micro-optimizations performed.
No matter what software framework is used, however the resizable capacitor bank is configured, or how many sensors are deployed within a coalesced sensor, a batteryless system is dead and unresponsive whenever there is insufficient energy: at nighttime, when stationary, without a nearby RFID transmitter, or exposed to an insufficient temperature gradient.
To truly address this problem, batteryless systems builders are left waiting for dramatic and transformative technology improvements. Either capacitor energy density must increase by 100-1000x, or system-wide power efficiency must similarly improve~\cite{curtiss2021facebit} to render capacitor-based storage appropriate for many applications.
This has resulted in industry continuing to build reliable and predictable battery-based sensors.
With the efficiency of current processor and radio technology, many applications can persist for a decade or more on just battery power~\cite{emersonRosemount,GEInsightMesh,honeywellOneWireless}.

%Right now, we have the technology to build long-lasting, reliable, and capable sensor networks that can address the needs of many applications. We do not need to wait for capacitors, radios, or processors to get better to enable some vision of a batteryless future.

%While researchers continue developing increasingly complex batteryless hardware and software frameworks, industrial solutions generally continue to dismiss batteryless solutions as an option.

%The batteryless design point is a red herring in the effort to build long-lasting wireless sensors. The promise of a power system that can persist theoretically indefinitely is tantalizing, but the trade off in terms of energy storage results in too much design complexity to produce a realistic solution

%The software and hardware landscape of batteryless systems is rife with complex solutions to address the many problems resulting from intermittent operation. All of these solutions are made irrelevant with more consistent and continuous operation, with traditional wireless sensor duty cycling.

%These complex software and hardware solutions, while increasing usability and reactiveness of batteryless systems, has not led to widespread adoption by industry.
%While a few companies are developing batteryless products, including EnOcean, Perpetua, and Everactive~\cite{enocean, perpetua, everactive}, the majority still employ non-rechargeable batteries.
%This is because existing intermittent work has not been able to address the singular problem for (super)capacitor-based energy
%harvesting systems: in the face of plentiful harvestable energy, they are not
%able to store the energy for later use (in times of energy drought).
%As a result, they must
%micro-optimize the little energy they have.
%In many applications, if these
%systems had sufficient capacity, they could capture a greater share of available energy, and simply adjust sensing rate and
%sleep periods to achieve energy-neutral operation.

%Despite the vast amount of work on new software and hardware techniques to enable and improve the generality, availability, and usability of batteryless systems, these techniques are unable to address the fundamental limitation of the batteryless design point: limited energy capacity.
%Beyond
%Other work in this space attempts to cope with
%intermittency
%by
%developing tools and
%programming language primitives that allow %can perform
%complex and energy intensive tasks to execute despite limited energy storage.
%Intermittent-aware programming
%models and compilers enable checkpointing and progress latching over
%workloads that may require more energy than can be stored
%~\cite{lucia2015simpler, ransford2012mementos, hesterTimely17}.
%New debugging tools
%spanning both the hardware and software domains
%measure the energy required for specific code operations
%and restore energy state during code breakpoints~\cite{colin2016energy}.


\section{Wireless Sensor Application Space}
\label{sec:background:app}
Many real applications have requirements for availability, latency, and data reliability that are at odds with what can currently be provided by batteryless systems, and in some cases energy harvesting methods as a whole.
There is a clear niche for batteryless systems for applications that can tolerate relaxed requirements, or are designed for reliable energy income, however it is disingenuous to argue that batteryless systems represent the future for all sensing applications.
The next section explores several example applications from the literature and industry, with qualitative and high level quantitative feasibility analysis.

%Over the past two decades, researchers have developed numerous examples of effective and useful applications using wireless sensors.
%As technological improvements in sensing, processing, and connectivity capability and efficiency increases, wireless sensors provide a large opportunity for autonomous, low or zero-maintenance sensing in many different sectors, including commercial, industrial, and personal sensing.
%Attempting to fully enumerate and identify all of existing applications as well as future opportunities is untenable.
%Instead, this section seeks to identify common wireless sensor application requirements and identify their impact on power supply design.

\subsection{Requirements}
\label{sec:background:background_reqs}
While the popularity and excitement around energy harvesting and batteryless sensing has led to progressively better batteryless systems, the focus on batteryless design has ignored the requirements of real world applications, and the limitations of the batteryless archetype.
Constraints like sensor size, lifetime, the availability of harvestable energy, and the reliability and consistency of an application should all contribute to the end design of a wireless sensor, and many applications will have requirements that make a batteryless design an unsuitable choice.
Instead of starting with the assumption that a design must be batteryless, a design should start from application requirements. Given an application, a set of questions should be asked to define its requirements and better define design parameters.
While not an exhaustive list, an appropriate set of questions to help define the power supply requirements should resemble the following:

\begin{enumerate}
    \item \textbf{What is the application lifetime requirement?}

    This question primarily defines the required lifetime of the wireless sensors driving the application. Secondarily, it also defines the acceptability of occasional power supply maintenance.

    \item \textbf{What level of availability is required by the application?}

    In this question, availability refers to the general ability of the sensor to remain online and maintain sensing at the rate required by an application. In this sense, availability is also analogous to reliability.
    Availability can be defined depending on the application reporting frequency and distribution. For applications that require measurements on a uniform sensing period, availability is defined by the percentage of intervals that the sensor was able to measure, or how often it was able to measure on schedule. For applications that are event driven, availability can be defined by the percentage of events captured by the sensor compared to the baseline distribution of events.

    \item \textbf{What are the average sensor power requirements to drive the application?}

    The power requirements of a sensor generally define application limitations for the size of the sensor, the feasibility of various energy harvesting methods, as well as the maximum lifetime on battery power.
    For opportunistic batteryless sensors, average power has a different meaning, as such sensors use any energy that is instantaneously available, and the average power they utilize varies with supply.
    There is still a limitation, as there is a minimum power required for a batteryless system to turn on and successfully activate.

    \item \textbf{What are the limits of area, volume, weight, and cost for each sensor?}

    The limits of size, weight, and cost of a sensor directly affects the amount of energy storage that can be allocated, or the available surface area for an energy harvester. Many applications have various limitations on the size of individual sensors as to not be burdensome, difficult to deploy, or unaesthetic.
    
%    \item \textbf{What are the constraints on energy storage to  
%
%    This requirement is primarily related to batteryless systems, which are severely limited by energy capacity. Assuming a perfect mechanism for ensuring forward progress, the energy storage of any wireless sensor must be large enough to support the most energy intensive operation of an application. In most cases, this is the amount of energy to send a single radio transmission.
%
\end{enumerate}

\noindent In the following subsections, several example applications from prior work are presented and their requirements placed within the context of the above questions. While this is by no means an exhaustive list, the examples discussed form a subset that provides broad coverage of applications that can and can not be supported by a batteryless design.
Some of these applications were developed before the introduction of batteryless sensors, however they are analyzed as if the technology and ideas existed to enable a batteryless option.
In \cref{chap:intuition}, these questions form the basis of formalizing a set of high-level application constraint equations to determine power supply design.
These constraints will help provide intuitive, application-based guidance for energy harvesting sensor design.

\subsection{Habitat Monitoring}
Perhaps the most notable seminal work in wireless sensor networks research is the deployment of 32 wireless sensors for habitat monitoring on Great Duck Island~\cite{mainwaring2002wireless}.
These sensors were built and deployed to measure the environmental conditions inside and around seabird nesting burrows, as well as their occupancy during breeding season.
This subsection attempts to explore this application's requirements and identify the suitability of energy harvesting and batteryless sensors to fulfill these requirements.

This habitat monitoring application has a necessary lifetime of 9 months, a time period that encapsulates the average 7 month sea bird breeding period.
The goal of the study is to measure burrow conditions and usage patterns consistently over a 24-72 hour cycle. The sensor must be able to measure occupancy consistently every 5-10 minutes overnight and in the early morning, when it is most likely that birds are leaving and entering the burrow.
It is acceptable to measure general environmental conditions within and outside the burrows every hour.
Thus, the in-burrow sensor must be able to sense occupancy and environmental conditions at regular intervals, without interruption.

To perform this task, based on technology available when this work was published, the burrow sensors required on average ~300\si{\micro\watt}. This power requirement is low enough to be powered by various energy harvesting methods, however there are not many options for harvesting within a sea bird burrow. Solar and thermal differential harvesting are not ideal. The inclusion of these harvesting methods would potentially make the burrows unappealing to sea birds, not to mention substantially increasing the deployment effort and cost.
External to the burrows, the gateway infrastructure for the deployment has plentiful solar energy to harvest from.

Given the application requirement of reliable and periodic measurement, as well as the unavailability of harvestable energy for in-burrow motes, this application is poorly suited for a batteryless solution.
While batteryless design The sensor designers chose to utilize non-rechargeable batteries as a source of energy, and tailored the size of the batteries as well as the sensor workload in order to support a 9 month lifetime.
Given the nature of this application, this design decision would be unlikely to change, even given modern technology.
There simply is no opportunity for energy harvesting, and the availability required of the in-burrow motes is higher than can be provided by any batteryless solution, even if energy was available.

\subsection{Wildlife Tracking}
Zebranet also represents a seminal work in wireless sensor design, involving the development and deployment of 30 tracking collars on zebras under study~\cite{juang2002energy}. Researchers were primarily interested in tracking the location and migration of zebras in an environment with no cellular or other broadcast communications. The collars include a GPS system, a short and long-range wireless transceiver, and a processor.

The wildlife biologists working with the system designers were interested in capturing GPS position every 3 minutes for at least 1 year of operation with no human maintenance or intervention. The biologists understandably want to limit the amount of tranquilizing and re-collaring of the zebras as much as possible. Like the habitat monitoring application, Zebranet also requires continuous and reliable operation to collect periodic GPS updates. Due to the lack of options for long range networking, the ZebraNet collars utilize peer-to-peer networking and mobile base stations to provide eventual data collection from the monitored zebras.

Conservatively, ZebraNet collars require an average of 405\si{\milli\watt} to perform GPS sampling and occasional peer-to-peer and base station networking. ZebraNet collars are relatively high power, even compared to its contemporaries like the Great Duck Island burrow sensors.
GPS and long range radio technology were fairly power hungry at the time the collars were designed.
The authors note that to power a collar for just 5 days would require a 13.5 \si{\ampere\hour} non-rechargeable battery, weighing 4 pounds. Not only would a non-rechargeable battery be unable to provide sufficient energy, it would also be too large and heavy to put on a zebra's neck.
Instead, the collar designers opted to use solar energy harvesting with a lithium polymer battery, resulting in a significantly smaller collar, weighing only 2.54~lbs total.
This allows the collar to harvest the copious amounts of sunlight during the day, and power the zebra localization workload all day and night.
With a batteryless design, the collars would be unable to function overnight or in the early morning, producing significant holes in zebra localization and behavior data.
Given modern technology, the collar \textit{could} utilize thermal gradient harvesting in addition to solar harvesting. This would allow harvesting overnight, as the gradient between zebra skin and ambient nighttime temperatures would be likely be sufficient to generate energy.
However, the relative power provided via thermal harvesting is several orders of magnitude less than harvesting direct sunlight, and much less than is required by the workload.
Even with additional harvesting sources, a batteryless collar would have to necessarily degrade the frequency of GPS sampling and communication with peers or the base station during times where the average power supplied by harvesting is less than required by the ideal workload.

\subsection{Asset Tracking}

In many industries, it is important but incredibly difficult to monitor and track various products and commodities through a supply chain.
Asset tracking sensors have the potential to provide finer granularity tracking and monitoring, which provide clearer estimates for production and delivery, as well help to increase efficiency by better tailoring supply to demand.
The lifetime of an asset consists of the amount of time it takes an item to traverse a supply chain end-to-end, from production to end retailer and user, potentially spending an unknown amount of time in a warehouse or on retail shelves.
The potential number of tracked items requires that such tracking sensors be small, cheap, and easily disposable or recyclable. Their lifetime must resemble the maximum shelf lifetime of any given product, which can vary widely.

Generally, these sensors are simple, and only need to report their location occasionally at each step of production or delivery, or respond to queries when inventory is taken.
This means their power requirements are modest, as
they do not need to consistently and periodically report their location or existence.
Asset tracking is a uniquely situated application that can benefit from batteryless design.
The infrequency of location reporting coupled with the requirement for cheap and easily disposable tags results in a design space that favors the batteryless regime.
As long as each step of a supply chain has installed infrastructure to wirelessly power and communicate with tags via RFID-like techniques, batteryless asset tags can provide accurate and reliable tracking updates.

Several recent companies are developing cheap batteryless asset tags, including Williot and Jeeva Wireless.
The Williot IoT Pixel is a peel and stick tag with an ARM Cortex M0+ and RFID harvesting and transmission antenna~\cite{williotpixel}.
The Williot system relies on RFID transmitter infrastructure to supply wireless power, and tags report their existence via BLE (Bluetooth Low Energy) which can be received by any consumer handheld device.
For applications where RFID infrastructure is sparse or inadequate, Williot also offers a battery-assisted tag with a battery lifetime of 4 years.
Jeeva Wireless is also developing low power RF-harvesting solutions for asset tracking. However, instead of active BLE transmissions, they rely on bidirectional backscatter communication with a wireless router~\cite{jeevawireless}.
When online and transmitting, a BLE advertiser like the Williot pixel will require on the order of 10s of \si{\micro\ampere} when advertising a full payload every 500\si{\milli\second}~\cite{nrf52Power}. A tag that utilizes backscatter will require much less to transmit data, on the order of single \si{\micro\ampere} or less depending on sleep state efficiency~\cite{jeevawireless}. This average power is well below the capabilities for directed RF harvesting from a device similar to an RFID reader, which can typically supply hundreds of \si{\micro\watt} at a minimum~\cite{sample2008design}.

Along with low power operation, asset tags must also be physically small and lightweight.
Arguably, the most convenient form factor resembles that of a traditional ``dumb'' tracking label: a peel and stick tracker with an integrated harvester and radio.
This form factor does not allow much space for a traditional non-rechargeable battery, but can supply enough surface area to support an energy harvesting RF antenna, an active antenna, and a limited amount of energy storage.
At most, the minimum atomic operation of an asset tracker must be sending
%energy storage of a tracker must be sufficient to
sending a single transmission indicating the tag's existence.
This amount of energy is easily supplied by a bank of capacitors~\cite{debruin2013monjolo, campbellEnergy14, yervaGrafting12}.
Beyond size, these asset trackers must also be inexpensive, and the cost difference between a non-rechargeable battery and a bank of ceramic or tantalum capacitors is substantial at scale.

In environments with plentiful and reliable harvestable energy, like in the case of asset trackers within a factory or warehouse with widely deployed RFID readers, the batteryless design point allows for simple, small, and inexpensive wireless devices that require nearly no maintenance.
However, when a batteryless asset tracker is out of range due to theft, accidental loss, or other reasons, it is impossible to locate them as they have no energy or way to communicate.
The value of batteryless trackers is strictly limited to specific locations and areas where the tracker is expected to be.
It is likely that such events are rare, and for most asset tracking use cases with plentiful infrastructure, a batteryless tracker is an ideal solution.
In situations where infrastructure is insufficient to power batteryless tags, non-rechargeable batteries may be necessary, as is the case for Williot's battery-powered trackers.

\subsection{Wearables}
%facebit? skinnypower?
%fitbit

Many human-centric applications are only possible when a sensor is co-located on the human body.
Often, wearables are the 
best and sometimes only way to accurately measure or interact with humans. 
These wearable sensors are uniquely situated when considering their power supply design.
For a wearable, a human is naturally always present and able to provide light maintenance or a recharge.
This allows wearables to have shorter one-charge lifetimes. 
Wearable maintenance is less costly when humans are always present and are already conditioned to maintain their devices.
Humans have generally accepted the cost of nightly smartphone recharging, making daily or weekly wearable charging also acceptable.
However, not all populations are as diligent or willing to utilize wearable sensors if they have repeatedly remove and charge them. Particularly, elderly populations have usability issues with discomfort and difficulties with taking wearables off to charge them and putting them back on~\cite{valk2018designing}.
For these populations, a wearable that does not need to be charged would provide significant utility. 
A batteryless wearable would not have a charging constraint, however
the expectation of constant and immediate wearable interactivity demands a baseline of availability that may not be sustainable with a batteryless design.
It is hard to imagine a user being willing to adapt their behavior to accommodate an infrequently available and sporadically operating device.
Several batteryless wearable applications have been proposed in the literature.

%Rechargeable wearables have less constraints on power compared to a similar sized sensor that must persist for years or decades. A batteryless wearable must still optimize for extreme low power operation.
%
%Wearables must also be as small and lightweight as possible.
%Batteryless systems that utilize ceramic and tantalum capacitors are often small, however any energy harvesting method requires significant surface area, such as solar panels, TEGs, and RF harvesting antennas.
%Even though capacitors themselves are tiny, no capacitor or supercapacitor can match the energy density of Lithium-based rechargeable batteries often used in consumer electronics.

\subsubsection{Gesture Recognition}
CapBand is a batteryless gesture recognition wearable that measures capacitive changes in skin deformations to identify hand gestures~\cite{truong2018capband}.
While the main contribution of this work is the sensing and processing of wrist capacitance measurements, the authors also claim that the low power nature of the measurement technique makes this appropriate for a batteryless design.
Capband utilizes a small solar panel for power, and a supercapacitor for energy storage.
Gesture recognition is an application that requires high availability to accurately capture hand gestures.
CapBand's capacitive measurement needs to run continuously to capture enough data to predict gestures, on the order of 20 measurements per second for its neural network inference.
At this rate, CapBand requires 260\si{\micro\watt}. This does not include the energy required to transmit the measurements.
The measurement power alone allows operation only outdoors during the daytime, and indoors with very bright lighting. 
This significantly limits the utility of the device, and would likely result in user frustration in insufficient lighting.

Wearables must optimize for size and weight. While CapBand fits within a wrist form factor, the sensing and energy management circuitry is quite large compared to a normal wristwatch or smartwatch. While there is some room for miniaturization by using different IC packages and combining modules into one PCB,  
the majority of volume and surface area of CapBand is actually devoted to the solar panel and supercapacitor. 
A small rechargeable 40\si{\milli\ampere\hour} could power the aforementioned 20\si{\hertz} measurement for 27 days, and would take less than half of the volume of CapBand's designed energy harvesting frontend.

CapBand's supercapacitor is sized to support an amount of sensing and data transmission while also minimizing the amount of time it takes to charge to a usable voltage. It is not designed to support a single atomic operation. CapBand is not designed to power off frequently. Instead, it sleeps when it does not have sufficient power.
A more energy dense storage, as well as one that has a more stable voltage, like a rechargeable battery, would also allow for continuous operation. A battery would also allow CapBand to operate overnight and in low light environments. 
The authors do not give consideration to a battery-based design, beyond claiming one would need frequent recharging.
It appears the decision to use a batteryless design was informed more by the popularity and excitement for battery-free technology, rather than a careful design exploration that considered all options. 

\subsubsection{Smart Face Mask}
Beyond traditional wrist-worn wearables, researchers are also developing ways to measure the efficacy of face masks and the health of the user.
The FaceBit platform is a smart mask platform that is affixed to normal masks and measures non-contact heart rate, respiratory rate, and mask fit quality and wear time.
FaceBit features a hybrid batteryless energy harvesting design with a backup primary battery. This hybrid design is intended to extend the lifetime beyond that of a primary-only design.
The authors explore multiple energy harvesting methods, including a photovoltaic cell, a thermoelectric generator (TEG), as well as a triboelectric nanogenerator (TENG).
The photovoltaic cell must be placed external to the mask, with power leads running into the mask, potentially degrading the mask fit.
The authors also test the use of a TEG placed against the inside mask surface, with the goal of harvesting from the temperature gradient from inside the mask to the surface of the mask. 
The TENG converts the small kinetic forces caused by breath into electricity, and is placed within the mask.
Regardless of energy harvesting modality, the current FaceBit design cannot operate in a fully batteryless fashion, as the reporting frequency and computational demands of the application requires more power and availability than possible with energy harvesting alone.

The FaceBit prototype can persist for 11 days before exhausting its small primary battery.
Its workload consists of periodically sampling a barometer sensor once a second to detect if it is being worn. If it is being worn, it measures  heart rate and respiratory rate every minute, and reports results every 2 minutes.
This workload requires high availability and consistent periodicity, which is difficult to achieve with a batteryless design. 
However, the authors identify several methods for energy harvesting that can provide consistent power while the mask is being worn.

The FaceBit lifetime and workload corresponds to an average power of 286\si{\micro\watt}.
While the current version relies mostly on a primary battery, it is also designed for energy harvesting.
Among the energy harvesting methods tested, only the photovoltaic in outdoor light can provide sufficient power to power the device.
In worst-case indoor conditions, where dim artificial lighting only provides on the order of 10\si{\micro\watt\per\centi\meter\squared}~\cite{yervaGrafting12}
the selected photovoltaic panel for FaceBit can only provide 71\si{\micro\watt}, assuming a 17\% efficiency.
The authors also explore the use of TEG and TENG generation.
Thermoelectric harvesting provides a temporary burst of energy on the order of 50\si{\micro\watt}, but quickly dissipates as the inside of the mask and the inside mask surface reach a temperature equilibrium. 
The TENG can provide consistent power if the mask is worn, but generally less than 2\si{\micro\watt} when the mask wearer is talking. No power data is provided for when the wearer is just breathing.
The authors believe that breath-based harvesting (Either TEG or TENG) are the most promising avenues for future development, despite their low power output.
They also claim that a 10x improvement in power efficiency of the SoC (including the processor and radio) would enable a batteryless version of the FaceBit.
This is not possible given the capability of the TEG and TENG methods explored. It would require closer to a 100x system-wide power improvement to enable a continuously operating batteryless FaceBit.

FaceBit must be sufficiently small and unobtrusive as to fit in an N95 or surgical mask without bothering the wearer.
It must also be lightweight enough to be held securely with a magnet affixed to the outside of the mask.
The authors claim that FaceBit is low-cost, but do not quantify it. 
A wearable that is affixed to disposable masks must be low cost enough to justify its use and periodic battery replacement.
The choice of non-rechargeable and rechargeable energy storage, as well as the harvesting method is the largest driver for the size, weight, and cost of a device like FaceBit.
The choice to use any energy harvesting, including the tested solar panel, TEG, or TENG requires significant surface area and added cost. 
The use of tantalum capacitors as energy storage is also one of the least energy dense options. 

The authors do not give a rationale for the decision to utilize capacitors as energy harvesting storage.
While each capacitor is individually small, FaceBit requires multiple capacitors to build up enough energy storage to successfully complete its most energy intensive operations.
Since the capacitor bank has very limited energy storage, the utility of having energy harvesting at all is severely limited.
FaceBit can only capture enough energy to perform a few operations before depleting its storage. Even in cases of sufficient harvesting, FaceBit can only use a small percentage of any available energy.
The authors do not examine how their energy storage capacity and chosen energy harvesting methods affect energy capture and the lifetime of FaceBit's primary cell.

The three capacitors that comprise FaceBit's energy storage require nearly 1.5x the volume of the primary battery itself, at significantly lower energy density.
An alternate design could more than double its lifetime by replacing energy harvesting and the capacitor bank with additional battery. 
Alternatively, the primary battery and energy harvesting components could be replaced by a single rechargeable battery and a charging connection.
A rechargeable battery is less energy dense than a primary cell and be unable to offer a similar lifetime. However, a rechargeable would reduce battery waste. 
Both options would result in a smaller, less cumbersome design. The removal of energy harvesting and related circuitry would also reduce the cost of the unit.

%\subsubsection{Intra-Body Power Transfer}

\subsection{Amalgamated Harvesting and Sensing}
There is a niche of applications where sensed phenomena is correlated with a method of harvesting.
As mentioned previously in \cref{cha:background:one-shot}, there are one-shot batteryless sensors that do not directly sense any phenomena, and instead simply transmit packets when their capacitor storage is charged and full.
The rate of packet transmission by these simple sensors can be used to directly estimate the rate of harvesting, and the intensity of a phenomena.
There are other applications that take this primitive one step further, and integrate active sensing for more direct and accurate measurements.
Applications that harvest the same phenomena that they sense are well situated for batteryless designs.
The inherent unreliability of a batteryless supply is not as impactful, as whenever there is energy to be harvested corresponds to when it is important to be sensing.
While energy harvesting methods are limited to just a few types, many valuable applications are still feasible.

\subsubsection{Power Metering}
%While it may seem counterintuitive or deceptive to argue that a sensor directly connected or close enough to be connected
%Sensors that are directly connected or near household power have a significantly easier time regarding harvesting energy. However, sometimes it is beneficial to
Usually, the proximity to existing power infrastructure presents relatively easy solutions for powering power meters.
For some use cases, this proximity is not enough to justify the cost of deployment.
It is generally burdensome and costly to instrument a building's circuit panel, as traditional submetering equipment must directly connect to a circuit, which requires an electrician install.
Many plug-load power meters are bulky and often block nearby outlets, and they require substantial standby power to operate.
The Monjolo power meter~\cite{debruin2013monjolo} instead utilizes a current transformer wrapped around one path of an AC power line to harvest energy.
The Monjolo operates on a one-shot batteryless design principle where the quantity and rate of packets can be used to determine the intensity and rate of current on the instrumented AC line.
%This design is not only easier to install, but is smaller and requires less standby power compared to power meters with converting power supplies.

The availability of a Monjolo power meter is also the availability of load power. For many loads, the sensor is not able to operate continuously, and when no load current is flowing, it will remain off and not send packets.
%Unlike other batteryless sensors that utilize desperate harvesting and sensing methods, where useful data may be missed if harvesting potential is insufficient during an interesting sensing event, i
When a Monjolo is offline for an extended period, it can be assumed that the measured load is also offline and drawing no power.
The zero-load assumption breaks down when considering real-world situations where operation and packet reception are not reliable.
If a Monjolo fails, or its packets are not reliably received for an extended period, it is impossible to distinguish from the sensor measuring no load.
Additionally, any missed packets has an impact on the reconstructed power rate estimation resulting in underestimation of power.
To account for this, Monjolo employs a monotonically increasing counter sent with each packet such that high level energy aggregation remains accurate.
However, this technique does not correct the loss in temporal power resolution from lost packets.

Because the Monjolo sensor operation is directly tied to its energy income, its power requirements vary depending on the measured load. At a minimum, it requires a load of at least 17\si{\watt} to harvest enough power to turn on and send a packet. This corresponds to a coil output power of less than 1\si{\milli\watt}. At some point the induced power from the magnetically coupled load is enough to power the Monjolo indefinitely. This point represents a maximum possible measurement, as the rate of packets is limited by how fast the sensor's software and hardware can queue and send packets when running continuously. For the Monjolo, this maximum corresponds to a measured load of 480\si{\watt}, and a packet frequency of 8.5\si{\hertz}.

Regarding size, the Monjolo platform must fit easily within a circuit breaker panel. Most of the volume of the Monjolo is dedicated to its coil harvester.
The 500\si{\micro\watt} storage capacitance and circuitry is small and amortized in comparison.
This capacitance is tuned to support a single Monjolo activation, allowing the sensor to wake up and transmit a packet.
However, with consistently powered or high current loads, the Monjolo harvester can provide significant energy, and a larger or more dense energy storage option could allow for better energy capture.
This would potentially support continuous operation and more advanced active sensing to directly measure current and voltage of the load without the need for power estimation from packet rate, and the limitations of upper and lower bounds of measurement.
%From the lessons of the Monjolo platform, among other works, industry has iterated upon this design and has utilized a rechargeable lithium battery.

In fact,
the Monjolo harvesting method and split-coil form factor has directly influenced further work and industry solutions.
The Triumvi system is a direct improvement over the Monjolo design, directly measuring voltage through capacitive coupling, and the current transformer to harvest energy and measure current~\cite{campbell2018energy}.
Like Monjolo, Triumvi is designed with a batteryless power supply, but supports an optional rechargeable battery for reliable, short term instrumentation.
Triumvi also supports charge sharing between devices, allowing a sensor harvesting and measuring a high load to share its harvesting energy with a sensor measuring a smaller load.
This increases the overall reliability and uptime of the entire deployment.
%However, industry has abandoned the batteryless principle of operation for more reliable and consistent operation, as well as direct, and accurate measurement methods.
Vizi metering is commercializing the Monjolo and Triumvi designs with some improvements.
%and developing the first non-contact voltage and current meter based on the Monjolo harvesting design~\cite{vizimetering}.
Instead of utilizing the one-shot activation and packet rate counting method of the Monjolo, the Vizi meter directly measures and reports current and voltage like Triumvi. This direct measurement is much higher accuracy than estimation through packet counting, with no phase information or voltage measurement.
Unlike both Monjolo and Triumvi, the Vizi meter is not batteryless. It uses a small rechargeable battery as its primary energy storage.
The Triumvi design has an option for a rechargeable battery, but it is considered secondary to the batteryless capacitor bank, and rechargeable batteries were only used for short investigative deployments.
Because of the onboard rechargeable battery, the Vizi meter can run continuously.
Continuous operation allows the meter to utilize reliable transport mechanisms to ensure all measurements are received successfully.
This preserves measurement temporal resolution.
%To support continuous operation, the meter utilizes a larger energy storage, replacing the capacitor bank with a rechargeable battery.
Like Triumvi, the Vizi meter also supports charge sharing.
If some meters within a circuit panel are connected to a infrequently active or low power load, and unable to harvest enough energy to support their workload, they are all daisy-chained such that meters on high-powered loads can share their harvesting energy among the entire deployment.
This daisy-chained connection also allows communication between sensors, primarily to synchronize measurements. This is especially useful for measuring three-phase or split-phase circuits.
Even though the Monjolo principle of operation is intuitive and a seemingly appropriate fit for a batteryless design, the limitations of measurement accuracy, resolution, and range are not appropriate for an industrial sensor. It was necessary for Vizi to abandon the batteryless aspect of Monjolo and Triumvi to achieve their availability, accuracy, and resolution goals.

\subsubsection{Archaeological Site Monitoring}
There are actually very few real-world deployments of long-term batteryless sensors that do not utilize outdoor solar harvesting.
One of the few examples is a 3.5 year deployment in the Mithrum of the Circus Maximus to measure ambient temperature, humidity, and structural vibrations~\cite{afanasov2020battery}.
Having data regarding the environmental conditions of the site helps restorers identify the necessary techniques for preservation.
The sensors involved with the deployment were originally battery powered sensors built with off the shelf components, and evolved into two classes of custom built batteryless sensors, one to measure temperature and humidity and the other vibrations.
This work is an interesting and unique analysis of the trade offs of battery-based and batteryless design.

The Mithrum is completely underground and only accessible through spiral staircases, and entry is closely regulated to protect the site.
Specifically, the installation of vibration sensors requires difficult climbing on potentially fragile vaults, putting not only the site in danger of damage, but also the safety of people installing sensors.
This makes periodic sensor network maintenance extremely costly.
While no sensor lifetime goal is stated explicitly by the authors, a lifetime should be maximized as much as possible.
The authors originally begin with a non-rechargeable battery-based design built with off the shelf processor, radio, and sensor modules.
Through the course of the 3.5 year deployment, the battery deployment experiences frequent outages, an average of 9 a year.
%Clearly, performing battery replacement and sensor maintenance every month is unacceptable for such a deployment.
%The ideal would be for the deployment to persist indefinitely, so
Due to these outages, the authors turn to batteryless designs for their environment and vibration sensors, producing custom application-specific hardware and software designs.

The authors do not explicitly mention many quantitative details of their designs including power and energy requirements for different operations, making it difficult to gleam the average application power requirements.
However, the off the shelf components used for the first deployment, along with the described workload provide some insight, enough to make an educated guess.
The first deployment utilized a Libelium Waspmote and an XBee 868LP sub-\si{\giga\hertz} radio~\cite{waspmote,xbeeradio}.
Combined, these two components require a sleep current of 34.7\si{\micro\ampere} at 3.3\si{\volt}.
The Waspmote is powered by an ATmega1281 and has an active current of 17\si{\milli\ampere} and frequency of 14.7456\si{\mega\hertz}.
%The ATmega1281 itself has an efficiency of 625\si[per-mode=symbol]{\micro\ampere\per\mega\hertz}.
The Xbee sub-\si{\giga\hertz} radio requires 45\si{\milli\ampere} when active and can transmit at 80\si[per-mode=symbol]{\kilo\bit\per\second}.
The temperature and humidity sensor only requires 600\si{\micro\ampere} when measuring, while the accelerometer requires 18\si{\milli\ampere} when active.
The temperature sensor workload consists of measuring temperature and humidity every 20 minutes, and transmitting an average and standard deviation every hour.
Similarly, the vibration sensors capture a one minute burst of accelerometer data every 20 minutes.
Every hour the acceleration data is summarized via an FFT, the fundamental frequency and spectral density is computed, and the results are compressed and sent.
With this information, we can estimate an average power draw for each system by making a few assumptions.
We assume every packet consists of a 32 byte combined header and overhead, individual data are encoded as 32-bit values, and the FFT is 128 bytes in length, of which only the real half needs to be transmitted, encoded individually as 8-bit values. \hl{TODO: power estimations}

The original battery-based deployment utilizes 6 C cell alkaline batteries for each sensor.
The authors do not note if the cells are configured in series or parallel.
These 6 cells can be configured 2x3 or 3x2 to achieve a nominal 3\si{\volt} or 4.5\si{\volt} supply respectively.
Both configurations supply voltage levels outside the acceptable range of the Waspmote (3.3-4.2\si{\volt})~\cite{waspmote_block}.
However, alkaline batteries quickly drop to 1.4\si{\V} when under load~\cite{alkaline_c}, providing an acceptable voltage in a 3x2 configuration.
The Waspmote only includes a 3.3\si{\volt} step down regulator (either a DC/DC converter or an LDO, the design diagrams do not specify) for the 3.3\si{\volt} supply to its MCU and other subsystems.
It does have a 5\si{\volt} DC/DC boost converter, however it is only provided to external modules.
This configuration of 6 C-type batteries provides a maximum of 16\si{\ampere\hour} at 4.5V.
However, the voltage curve of alkaline cells is fairly linear, and without regulation this configuration will drop below the minimum voltage requirement of 3.3\si{\volt}(1.1\si{V} per cell) at about one half of its full capacity~\cite{alkaline_c}.
When considering the requirements of the vibration sensor, this battery configuration should provide around a year of continuous operation.
The temperature and humidity sensor is lower power, and should last much longer.

Despite this significant and sufficient lifetime estimation, the amount and
frequency of failures experienced by the real deployment points to multiple
issues that were not predictable at design time.
The authors make indirect
arguments that the sensor power draw is higher than
expected, but do not give a reason. Perhaps power draw is higher due to
software bugs.
It is difficult to design low power software that avoids all
unintentional energy usage or instances of inescapable high power states.
The authors make efforts to lower system power
with little impact (a 1.7\% improvement).
Besides energy efficiency of the system, the authors lay most of the blame of
sensor failures on batteries.
They claim that temperature fluctuations and high humidity in the
underground chambers of the Mithrum cause frequent battery failure.
The authors describe these battery failures due to
environmental conditions anecdotally, without any quantitative experimentation into
why batteries are prematurely failing.
The authors also claim that different primary battery types, such as
lithium, exhibit the same issues.
To solve this problem, the authors elect to change their sensor design to be batteryless.
Their first attempt uses the same COTS components but connected to a harvester.
The second attempt is a custom application-specific hardware design with more efficient
components.
The authors never
descuss any efforts to
mitigate
humidity with waterproof enclosures, humidity absorbers, or conformal
coatings and epoxy.
It is my opinion that the authors were searching for a reason to make a
batteryless design for this application, and found a reason when they encountered initial difficulties with
batteries in humid environments.
Despite this, this work presents an interesting, if incomplete, side-by-side
comparison of a battery-powered deployment and a batteryless deployment.

\subsubsection{Cathodic Protection Monitoring}
Beyond the coupling of sensing to harvesting, sometimes harvestable power is reliable.
Reliable power can be produced from a consistent temperature differential between a hot steam pipe and the ambient air, microbial activity within soil or wastewater fuel cells, or the voltage potential produced from a sacrificial anode in a home water heater, a boat, or a bridge.
In these situations, reliable harvestable energy results in a reliable system, even when batteryless.
This allows a batteryless system to maintain a regular and periodic sensing schedule.
These applications are clever and convenient for batteryless systems, as a reliable power source allows them to avoid the uncertainty of an unreliable income.

Researchers have built proof-of-concept sensors that monitor and harvest from the corrosion of cathodic protection systems~\cite{jagtap2021repurposing}.
A corrosion protection system is sometimes employed on critical infrastructure, especially in aqueous environments, to prevent corrosion.
This protection usually consists of bars of a sacrificial metal, usually of elements that are more easily corroded, like aluminum or magnesium.
The critical metal structure is protected from corrosion, as the sacrificial metal corrodes first.
%In some cases, an active system is deployed that applies reverse DC current to prevent corrosion.
It is important to monitor the state of a cathodic protection system, because as soon as it is depleted, the metal structure that was being protected will begin to corrode.

The chemical process of corrosion is the same process as a galvanic battery.
A cathodic protection system is not a \textit{good} battery.
It provides a very low peak power, and has very high equivalent series resistance.
However, a cathodic protection system can be used to slowly charge an actual battery, a bank of capacitors, or a supercapacitor.
This stored energy can then be used to monitor the health of the protection system, powering periodic voltage measurements between the sacrificial anode and the protected cathode, and reporting these readings via radio transmissions.
As long as a sacrificial cathode exists and is performing its function, a sensor will be able to scavenge energy from it.
Such a system must persist for the life of the cathode or infrastructure, which in the case of a water heater can be between 1-3 years for the cathode, and around 10 years for the heater itself~\cite{jagtap2021repurposing}.
While this lifetime could be supported by a non-rechargeable battery, it is both more elegant and less wasteful to employ an energy harvesting solution.
Since the degradation of a sacrificial anode is slow, over the course of multiple years in the case of a water heater, such a sensor does not need to report frequently.
Once a day is sufficient to track the health of the sacrificial anode and predict its failure.
%The authors do note that harvesting energy from a cathodic protection system can accelerate its degradation, however an ultra-low power system is unlikely to have a noticeable effect.

The authors propose a fully energy harvesting solution, meaning that the average power of their application must be energy neutral, and fully dependent on income from the weak corrosive battery.
Via multiple experiments with a small corrosion cell consisting of a steel bucket and a magnesium rod, the researchers have discovered a maximum power point at around 300\si{\milli\volt} and 1.6\si{\milli\ampere} for a peak power of 480\si{\micro\watt}.
Even from a small example corrosion cell based on a water heater, this amount of average power is more than enough to power a low duty-cycle sensor system.
In many cases, the infrastructure being monitored will be much larger, with more surface area resulting in more harvestable power.
The size of the designed system is not of particular concern, as it connects to potentially huge infrastructure.
Any sensor built will be easily dwarfed by a water heater or a bridge.

Since the energy income from a cathodic protection system is stable and reliable up until the point where it fails, a batteryless design is an attractive choice.
The constant minute income power allows a system to preserve volatile state over long sleep periods without the need for intermittent techniques to ensure forward progress.
The left over energy is banked and eventually used to monitor and report the health of the sacrificial anode.
The authors decide to use a parallel array of three 1\si{\farad} supercapacitors to store harvested energy from corrosion.
This bank of supercapacitors is sized such that it provides enough energy storage for the system to run continuously and measure the voltage between the anode and cathode every 4 hours on average.
The system then transmits the results via a LoRa radio, which has relatively high power and energy costs.
The authors avoid tantalum and ceramic capacitors used in past designs, as their energy density is insufficient to support LoRa operations within a reasonable form factor.
Alternatively, such a system could utilize a rechargeable battery.
A single small rechargeable battery is more energy dense and significantly less costly than the bank of three large supercapacitors used.
This would result in a smaller, lighter, and cheaper system.
The authors' concerns of battery cycle lifetime, charging characteristics, and voltage requirements, are actually inconsequential, especially for this application.
They do not provide any citations for any of these assertions.
Given the application's infrequent periodicity, cycle depth is shallow, and average discharge and charge rates are low, resulting in less cell damage and an extended cycle lifetime~\cite{omarLithium14,wangCycle11}.
For most lithium-based batteries, this would result in at least the 10 year lifetime of the instrumented water heater, never mind the 1-3 year lifetime of the sacrificial anode.
The authors' issue with voltage levels is easily addressed with a buck or boost regulator, depending on the battery chemistry.
These trade-offs between capacitors, supercapacitors, and batteries are further explored in \cref{chap:battery}.

\subsection{Smart Dust and the Future}
Beyond applications that were possible ten years ago, as well as ones that are possible today, it is important to look forward to the requirements of future applications.
The continuing trend in computing and wireless sensors is pushing the boundaries on size and power.
Researchers have begun prototyping a new class of  
millimeter-scale computers and sensors, known colloquially as ``smart dust''~\cite{warneke2001smart}.

While some developed millimeter-scale systems are one-off demonstrations of the feasibility of the device class, some have been developed for specific applications.
In particular, millimeter-scale sensors are uniquely appropriate for injectible or implantible medical applications.
Millimeter-scale devices have been proposed as syringe-implantable medical sensors to to measure and monitor 
intraocular pressure for glaucoma diagnosis and management~\cite{ghaed2013circuits},
heart arrhythmia~\cite{chen2014injectable},
glucose levels for diabetes treatment~\cite{nazari2019novel}, and cellular temperature to monitor the metabolism of cancer cells~\cite{wu20180}.
Beyond health applications, general purpose, modular, millimeter-scale sensing platforms have been proposed for traditional sensing applications~\cite{lee2013modular, kim2014millimeter}

The lifetime goals for many of these applications are to operate perpetually based on available energy~\cite{kim2014millimeter, lee2013modular}. For many of the medical applications, lifetimes of a few years to decades are appropriate to avoid frequent sensor re-injection and re-implantation~\cite{chen2014injectable}.
Typically, these applications require high availability to support reliable and periodic measurements.
High quality, consistent measurements are necessary to establish reliable trends for the basis of diagnoses or treatments.
Likewise, non-medical smart dust applications also require high availability.
A millimeter-scale image sensor application utilizes always-on motion detection as opposed to opportunistic or periodic image sensing~\cite{kim2014millimeter}.
This approach attempts to maximize the value of captured images and minimize wasted energy on capturing multiple identical images.

Despite the high energy density of primary lithium batteries, at the scale of a \si{\milli\meter}, the energy provided is insufficient to offer an adequate lifetime for these systems~\cite{lee2013modular}.
To achieve perpetual lifetimes, these systems utilize harvesting methods including photovoltaic, active RF, intra-body transfer, or optical harvesting~\cite{wu20180, lee2013modular, nazari2019novel}.
Due to their size, these systems have limited volume for energy storage, and likewise limited surface area available for energy harvesting.
This results in aggressive system-wide power limitations to achieve adequate lifetimes with high availability.
Unlike the previously mentioned devices and platforms, most of which require on the order of hundreds of \si{\micro\watt} to \si{\milli\watt} of average power to drive their application, smart dust devices operate with an average of tens or hundreds of \si{\nano\watt}~\cite{lee2013modular,kim2014millimeter,chen2014injectable,wu20180}.

Given the low energy density of capacitors and supercapacitors, they would provide insufficient energy storage to allow continuous and perpetual operation, making batteryless approaches unsuitable for many smart dust applications.
Instead, to achieve high availability, most of the aforementioned systems utilize small rechargeable thin-film lithium batteries to allow operation between periods of harvestable energy. These batteries are sized to provide a few days of operation without any income, corresponding to capacities on the order of 1-5 \si{\micro\ampere\hour}. 

Not all applications require the extreme size constraints of smart dust, however, they can benefit from the advancements in power efficiency developed by smart dust researchers.
Within the next decade it is conceivable that microcontrollers, sensors, and radio technologies will be developed with the power improvements originally meant to enable millimeter-scale computing.
These sensors can remain at the scale of traditional sensor motes with relatively vast energy storage and energy harvesting capability, but with one or two orders of magnitude improvement in active and idle power.
This will result in sensors that can easily achieve lifetimes of multiple decades, even with small primary batteries. 
With average system power on the order of \si{\nano\watt}, batteries will be limited more by self-discharge than the actual system load.
For energy harvesting systems with sufficient surface area, an average income power on the order of tens or hundreds of \si{\nano\watt} to support perpetual operation is an easy task even in dim environments. 
Beyond lifetime extension, these sensors will be capable of doing more with the energy they have. Future systems will perform advanced sensing and processing that are currently infeasible due to energy constraints. 
Some of the advancements that have led to the power efficiency of millimeter-scale systems are starting to be commercialized.
In particular, the development of high performance subthreshold near-threshold computing has resulted in an order of magnitude improvement in active power over traditional CMOS supply voltage techniques~\cite{zhai2009energy, dreslinski2010near}.
Ambiq Micro has led the commercialization of this technology, starting with ultra low power real time clocks, and more recently developing microcontrollers like the Apollo4 that requires only 5\si[per-mode=symbol]{\micro\ampere\per\mega\hertz}.
This represents an order of magnitude improvement over similar offerings, like the Nordic nRF5340, which requires 56\si[per-mode=symbol]{\micro\ampere\per\mega\hertz}~\cite{nrf5340}.


%\subsection{Example Applications}
%Based on the first requirement question, applications can be categorized by their average power requirements. The next few sections describe several wireless sensor applications, placing them within different power regimes. This includes applications that require Milliwatts of average power, ones that require Microwatts, and those that require Nanowatts.
%
%\subsubsection{Milliwatt regime}
%This regime consists of applications that subsist on Milliwatts of power. Often, these applications are examples of older work, with less efficient technology, as well as applications with large batteries, or ones that exist in environments with plenty of available harvestable energy, allowing relatively high average power requirements.
%
%\subsubsection{Microwatt regime}
%\subsubsection{Nanowatt regime}
%\subsubsection{Static Monitoring}
%\begin{enumerate}
%    \item GDI ~\cite{mainwaring2002wireless}
%    \item Redwoods ~\cite{tolle2005macroscope}
%    \item Monjolo/Powerblade
%    \item Signpost ~\cite{adkins2018signpost}
%    \item Mithraeum ~\cite{afanasov2020battery}
%    \item Cathode ~\cite{jagtap2021repurposing}
%\end{enumerate}
%\subsubsection{Wearable}
%\subsubsection{Tracking and Localization}
%\begin{enumerate}
%    \item ZebraNet ~\cite{juang2002energy}
%    \item SnapLoc ~\cite{grossiwindhager2019snaploc}
%    \item SociTrack ~\cite{biri2020socitrack}
%    \item Glitter ~\cite{sharma2020all}
%\end{enumerate}
%\subsubsection{Other?}
%
%\subsection{Size}
%
%\subsection{Power}
%
%\subsection{Harvesting Potential}
%
%\subsection{Atomicity}
%
%\subsection{Lifetime}
%
%\subsection{Reliability}





\section{Power Supply Design Archetypes}

All wireless sensors require electrical energy to function.
That energy must either be allocated prior to deployment, or provided or collected during deployment.
The archetypes presented in \cref{fig:background:archetypes} represent the high-level architectural possibilities for storing energy and powering wireless sensors.
Energy storage and harvesting technology is rapidly improving, and varied application requirements will result in different design parameters. Despite this, the power supplies for all wireless sensors can be divided into clearly delineated design patterns.
Most simply, energy can be provisioned in a finite energy storage like a battery, also known as a primary cell. In situations where there is harvestable energy, it can be captured and stored in rechargeable storage, or a secondary cell.
If the available harvestable energy is on or below the edge of being sufficient to fully power a sensor and its workload, harvesting can be paired with a backup primary source to ensure consistent, reliable operation with an extended lifetime.
These three classes of design archetypes encompass the options for wireless sensor power supplies, if not for all electronic devices.
The next few sections explore the gradient of design space in more detail, and identify existing systems and their place within the design space.

\subsection{Primary-only}
Non-rechargeable (primary-cell) batteries have been the preferred
method of powering sensors for both academic experimentation
and commercial and industrial applications.
The Telos family of motes, originally designed in 2004~\cite{polastre2005telos},
is still the wireless platform of choice for some modern research projects~\cite{mohammad2018codecast,li2019privacy}.
The Hamilton mote is an example of an attempt to provide a more modern, cost-effective alternative to older motes~\cite{andersen2017hamilton}.
Besides research platforms, the majority of commercial smart home sensors, like those offered by Ecobee, Honeywell, Lutron, Nest, Phillips, among many others, all opt to use non-rechargeable batteries as their source of energy
~\cite{ecobeeSensor, honeywellThermostat, lutronSolutions, googleNestTemperature, hueSensor}.
Industrial offerings from Emerson, GE, Honeywell, and others also utilize non-rechargeable power cells in their reliable wireless sensors~\cite{emersonRosemount,GEInsightMesh,honeywellOneWireless}.
The use of primary-cells is popular in commercial and industrial sensing because they enable sensors with predictable lifetimes that are easy to
design, simple to program, and reliable to operate.
A finite energy storage provides a finite lifetime, meaning battery replacement is inevitable. However, advances in energy efficiency and battery technology have resulted in reliable sensors that can last up to 10 years without battery maintenance~\cite{emersonRosemount,honeywellOneWireless, lutronSolutions}.

\subsection{Energy Capture with Buffer}
%Prior work regarding energy-harvesting sensor systems can be broadly
%divided into two categories: those which make use of intermittent computing
%techniques and those which do not.
%Intermittent systems often exist in a regime of unreliable and ultra low harvester power, where
%operation and uptime are not guaranteed. As such, they often lose power and
%reboot while intermittently working through a sensing task.
%A wealth of work has been devoted to
%making these systems usable and reliable.
%Other energy-harvesting systems, especially those deployed outside, have access
%to significantly more harvestable energy and are able to store more of this energy
%for later use, so they
%do not use intermittent computing techniques to complete their workloads.

Instead of preallocating energy, a system can utilize external sources of energy.
The quantity, and consistency of external energy can vary widely. If the energy is predictable or reliable, a system can be powered entirely from the external source. If the source is unpredictable, captured energy can be stored or buffered in rechargeable storage, generally a (super)capacitor or battery to use in times where external energy is unavailable.

At one extreme of power delivery, a wireless sensor can be powered by a reliable source, like wired power.
As much as it seems like an antithesis to "wireless" sensors, wired power is a solution for a class of applications where using a battery is more costly than installing wired power.
This is especially true for applications that are monitoring powered devices or measuring mains power.
For example, the Powerblade power meter is connected to AC mains power for both measurement and power supply~\cite{debruin15powerblade}.
Its proximity to readily available AC power and its small form factor make the inclusion of a battery infeasible compared to scavenging off mains power.

The majority of wireless sensors that depend on external sources of energy are energy-harvesting. They utilize
%e, energy harvesting that is utilized in environments with sparse and inconsistent energy results in extremely low power designs, and designs that operate intermittently.
photovoltaic, thermoelectric, piezoelectric, ambient RF harvesting or other methods to scavenge energy from their environment.
This results in limited and unreliable energy income.
Parameters like harvester size or surface area, and harvesting method, impact the amount of potential power delivered to the sensor, while the size and capacity of the rechargeable storage determines how much energy can be buffered.
This device class can be further differentiated by how captured energy is stored. Intermittent, or batteryless systems, eschew both non-rechargeable and rechargeable batteries and utilize capacitors and supercapacitors for energy buffering. The choice of a (super)capacitor buffer significantly limits the amount of energy capacity available to the system, reducing its capability to cache energy in times of drought. This choice is predicated on the assumption that rechargeable batteries are less suitable for energy harvesting applications. However, most energy harvesting systems, particularly those that utilize outdoor photovoltaic harvesting, utilize rechargeable batteries.


\subsubsection{Non-intermittent Sensors}
\label{sec:related:nonintermittent}
Non-intermittent energy-harvesting sensors
have largely existed in environments with plentiful harvestable energy
and have been designed with sufficient capacity to capture this energy.
%Some
%devices have also embraced backup primary-cells to further ensure
%reliable operation.
%In the middle, in environments with sufficient and predictable available energy, designs can scavenge energy and store it in a rechargeable battery to power their workload.
Most examples of such devices are deployed outdoors with photovoltaics~\cite{jiang2005perpetual, kansal2007power, corke2007long, lin2005heliomote, adkins2018signpost}.
%Energy harvesting in industrial environments is also possible with sufficient heat differential or vibrational sources~\cite{perpetua, kinergizer}.
%However, the adoption and application of such harvesting methods is limited and non-rechargeable batteries remain the most popular option for powering industrial sensors.
%Notably, Prometheus utilizes a supercapacitor as a short term energy store, and when full,
%charges a backup rechargeable lithium battery~\cite{jiang2005perpetual}. At
%the time of its design, lithium cells offered highly limited recharge cycles,
%and by utilizing a supercapacitor, much of this
%charge-discharge volatility was masked from the secondary-cell, extending its lifetime.
Non-intermittent sensors have also been employed indoors.
The EnHANTs sensor uses an indoor photovoltaic panel to charge an intentionally oversized NiMH
battery, with plans to eventually use a thin-film battery~\cite{margolies2015energy}.
DoubleDip utilizes thermoelectric harvesting to charge a lithium-manganese battery~\cite{martin2012doubledip}
These examples are of older designs, using older battery technology that had limited cycle lifetimes. However, the greater energy capacity provided by batteries allows these designs to avoid the complications of intermittency and batteryless operation.
The popularity of batteryless systems has led to a distinct lack of modern research systems that utilize rechargeable batteries, especially those that are not outdoors.

%DoubleDip notes that supercapacitors offer
%lower energy density and higher leakage when compared to batteries, but admits
%that the lithium-manganese chemistry suffers from low maximum output currents
%and a limited number of charge-discharge cycles.
%While the limitations of past batteries have slowed their adoption in
%low energy-harvesting scenarios, we claim that recent developments in battery
%technology will enable higher capacity energy storage without these trade offs.


\subsection{Energy Capture with Buffer and Primary}

Regardless of which energy store is used, energy-harvesting systems will
experience some degree of uncertainty regarding energy income.
A non-rechargeable
backup energy store can be utilized to mask this uncertainty, cold
start electrical components, and provide consistent, reliable, and lively operation.
A third design archetype is a combination of the first two:
external energy capture paired with a backup non-rechargeable cell.
While this archetype makes sense from the perspective of maximizing system lifetime and reliability, it is not commonly employed.
The Pressac line of supercapacitor-based energy-harvesting sensors
use a battery backup to obtain an estimated 10 years of continuous, reliable operation~\cite{pressac}.
%This work suggests that these sensors could significantly
%increase their lifetime by using a larger secondary energy store.
There has been little
exploration on the benefits of this hybrid design and the use of
primary-cells to avoid intermittency,
and provide baseline reliability. This dissertation seeks to explore this design point in more detail.




